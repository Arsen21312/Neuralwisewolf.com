<!DOCTYPE html>
<html lang="ru">
<head>

  <script>
(function () {
  var isGH = location.hostname.endsWith('github.io');
  var repo = isGH ? location.pathname.split('/')[1] : '';
  var href = isGH ? '/' + repo + '/' : '/';
  var b = document.createElement('base');
  b.setAttribute('href', href);
  document.head.prepend(b);
})();
</script>

  <!-- favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/logowolf.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/logowolf.png">
  <link rel="apple-touch-icon" href="assets/logowolf.png">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IP Address Lookup | Neural Wise Wolf</title>
  <meta name="description" content="IP Address Lookup: мой IP, данные по IP или домену, геолокация, ASN/ISP, таймзона, валюта, reverse DNS.">
  <base href="/Neuralwisewolf.com/">
  <link rel="stylesheet" href="assets/styles.css">
  <style>
    .tool-header{ text-align:center; margin-bottom:1.5rem; }
    .tool-header p{ max-width:720px; margin:.25rem auto 0; color:var(--text-secondary); }

    .iptool{ max-width:1000px; margin:0 auto; }
    .panel{ background:var(--bg-primary); border:1px solid var(--border-light); border-radius:20px; box-shadow:var(--shadow-md); padding:1.25rem; }
    .grid{ display:grid; gap:1rem; grid-template-columns: .95fr 1.05fr; }
    @media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }

    .field{ background:var(--bg-secondary); border:1px solid var(--border-light); border-radius:12px; padding:.9rem; display:flex; flex-direction:column; gap:.6rem; }
    .row{ display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .text,.select{ width:100%; padding:.7rem .8rem; border:1.5px solid var(--border-medium); border-radius:10px; background:var(--bg-primary); color:var(--text-primary); }
    .text:focus,.select:focus{ outline:none; border-color:var(--accent-primary); box-shadow:0 0 0 3px color-mix(in srgb,var(--accent-primary) 20%, transparent); }
    .mini{ padding:.6rem .8rem; border:1px solid var(--border-medium); background:var(--bg-primary); border-radius:10px; cursor:pointer; }
    .mini:hover{ background:var(--bg-secondary); }

    .cards{ display:grid; gap:.9rem; grid-template-columns:repeat(auto-fit,minmax(210px,1fr)); }
    .card{ background:var(--bg-secondary); border:1px solid var(--border-light); border-radius:14px; padding:1rem; }
    .k{ color:var(--text-secondary); font-size:.85rem; }
    .v{ font-weight:800; font-size:1.15rem; margin-top:.15rem; word-break:break-all; }
    .flag{ font-size:1.4rem; vertical-align:middle; margin-left:.25rem; }

    .details{ display:grid; gap:.7rem; grid-template-columns: 1fr 1fr; }
    @media (max-width: 700px){ .details{ grid-template-columns: 1fr; } }
    .kv{ display:flex; gap:.5rem; }
    .kv .key{ width:180px; color:var(--text-secondary); }
    .kv .val{ flex:1; word-break:break-word; }

    .code{ background:var(--bg-secondary); border:1px solid var(--border-light); border-radius:12px; padding:.9rem; font-family:ui-monospace,Consolas,Menlo,monospace; font-size:.92rem; white-space:pre-wrap; word-break:break-word; }
    .hint{ color:var(--text-secondary); font-size:.9rem; }
    .muted{ color:var(--text-secondary); font-size:.9rem; }

    .related-tools{ margin-top:28px; padding-top:18px; border-top:1px solid var(--border-light); }
    .related-header{ margin-bottom:10px; }
  </style>
</head>
<body>
  <div data-include="header"></div>
  <div data-include="sidebar"></div>
  <div id="overlay" class="overlay"></div>

  <main class="tool" data-category="dev" data-slug="ip-address-lookup">
    <div class="tool-container">
      <div class="tool-header">
        <h1>IP Address Lookup</h1>
        <p class="tool-description">Определи свой IP. Узнай страну, город, координаты, таймзону, провайдера, ASN, reverse DNS по IP или домену.</p>
      </div>

      <div class="iptool">
        <div class="panel">
          <div class="grid">
            <!-- Left: input & actions -->
            <div class="field">
              <label for="query"><strong>IP или домен</strong></label>
              <input id="query" class="text" placeholder="например: 8.8.8.8 или example.com" autofocus>

              <div class="row">
                <button id="myIp" class="mini">мой IP</button>
                <button id="lookup" class="mini">поиск</button>
                <button id="clear" class="mini">очистить</button>
                <button id="copyJson" class="mini">копировать JSON</button>
              </div>
              <div class="muted" id="status">Готово</div>

              <div class="field" style="margin-top:.6rem">
                <div class="k">Подсказки</div>
                <ul class="muted" style="margin:.2rem 0 .1rem 1.1rem">
                  <li>Поддерживаются IPv4, IPv6 и домены. Для домена сначала делается A/AAAA lookup.</li>
                  <li>Данные от нескольких провайдеров с резервом (ipify, ipwho.is, ipapi.co, Google DNS).</li>
                </ul>
              </div>
            </div>

            <!-- Right: results -->
            <div class="field">
              <div class="cards">
                <div class="card">
                  <div class="k">IP</div>
                  <div class="v" id="ipOut">—</div>
                </div>
                <div class="card">
                  <div class="k">Страна</div>
                  <div class="v" id="countryOut">—</div>
                </div>
                <div class="card">
                  <div class="k">Город</div>
                  <div class="v" id="cityOut">—</div>
                </div>
                <div class="card">
                  <div class="k">Провайдер / ASN</div>
                  <div class="v" id="ispOut">—</div>
                </div>
              </div>

              <div class="details" style="margin-top:.8rem">
                <div class="kv"><div class="key">Координаты</div><div class="val" id="coordOut">—</div></div>
                <div class="kv"><div class="key">Таймзона</div><div class="val" id="tzOut">—</div></div>
                <div class="kv"><div class="key">Валюта</div><div class="val" id="currencyOut">—</div></div>
                <div class="kv"><div class="key">Континент</div><div class="val" id="contOut">—</div></div>
                <div class="kv"><div class="key">Регион / Почтовый код</div><div class="val" id="regionOut">—</div></div>
                <div class="kv"><div class="key">Reverse DNS (PTR)</div><div class="val" id="ptrOut">—</div></div>
                <div class="kv"><div class="key">Ссылки</div><div class="val" id="linksOut">—</div></div>
              </div>

              <div style="margin-top:.8rem">
                <div class="k">JSON</div>
                <div id="jsonOut" class="code">{}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
        <div data-include="related"></div>
      </div>
    </div>
  </main>

  <div data-include="footer"></div>

  <script src="js/loader.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const q = document.getElementById('query');
    const myIp = document.getElementById('myIp');
    const lookup = document.getElementById('lookup');
    const clearBtn = document.getElementById('clear');
    const copyJson = document.getElementById('copyJson');
    const status = document.getElementById('status');

    const ipOut = document.getElementById('ipOut');
    const countryOut = document.getElementById('countryOut');
    const cityOut = document.getElementById('cityOut');
    const ispOut = document.getElementById('ispOut');
    const coordOut = document.getElementById('coordOut');
    const tzOut = document.getElementById('tzOut');
    const currencyOut = document.getElementById('currencyOut');
    const contOut = document.getElementById('contOut');
    const regionOut = document.getElementById('regionOut');
    const ptrOut = document.getElementById('ptrOut');
    const linksOut = document.getElementById('linksOut');
    const jsonOut = document.getElementById('jsonOut');

    function setStatus(t){ status.textContent = t; }

    const ipv4Re = /^(\\d{1,3}\\.){3}\\d{1,3}$/;
    const ipv6Re = /^([0-9a-f]{1,4}:){1,7}[0-9a-f]{1,4}$/i;
    function isIPv4(s){ return ipv4Re.test(s); }
    function isIPv6(s){ return ipv6Re.test(s) || s.includes('::'); }
    function looksLikeDomain(s){ return /[a-zA-Z]/.test(s) && s.includes('.'); }

    function flagEmoji(cc){
      if(!cc) return '';
      const code = cc.toUpperCase();
      const base = 127397;
      return String.fromCodePoint(...[...code].map(c => c.charCodeAt(0)+base));
    }

    function fmt(obj){
      try{ return JSON.stringify(obj, null, 2); }catch{ return String(obj); }
    }

    async function fetchJson(url, timeoutMs=6000){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), timeoutMs);
      try{
        const r = await fetch(url, {signal: ctrl.signal});
        clearTimeout(t);
        if(!r.ok) throw new Error('HTTP '+r.status);
        const ct = r.headers.get('content-type') || '';
        if(ct.includes('application/json')) return await r.json();
        const txt = await r.text();
        try{ return JSON.parse(txt); }catch{ return {value: txt}; }
      }catch(e){
        clearTimeout(t);
        throw e;
      }
    }

    async function resolveHost(name){
      // Google DoH для A/AAAA
      try{
        const A = await fetchJson('https://dns.google/resolve?name='+encodeURIComponent(name)+'&type=A');
        const aAns = (A.Answer||[]).filter(x=>x.type===1).map(x=>x.data);
        if(aAns[0]) return aAns[0];
      }catch{}
      try{
        const AAAA = await fetchJson('https://dns.google/resolve?name='+encodeURIComponent(name)+'&type=AAAA');
        const aaaaAns = (AAAA.Answer||[]).filter(x=>x.type===28).map(x=>x.data);
        if(aaaaAns[0]) return aaaaAns[0];
      }catch{}
      throw new Error('Не удалось разрешить домен');
    }

    function v4toArpa(ip){
      return ip.split('.').reverse().join('.') + '.in-addr.arpa';
    }
    function v6toArpa(ip){
      // упрощённо (без полной нормализации): расширим ::
      // если не получится — вернём null
      try{
        const parts = ip.split('::');
        let hextets = [];
        if(parts.length===1){
          hextets = ip.split(':');
        }else if(parts.length===2){
          const left = parts[0] ? parts[0].split(':') : [];
          const right = parts[1] ? parts[1].split(':') : [];
          const missing = 8 - (left.length + right.length);
          hextets = [...left, ...Array(missing).fill('0'), ...right];
        }else{
          return null;
        }
        hextets = hextets.map(h => h.padStart(4,'0'));
        const nibbles = hextets.join('').split('').reverse().join('.'); // по одной цифре
        return nibbles + '.ip6.arpa';
      }catch{ return null; }
    }

    async function reversePtr(ip){
      try{
        if(isIPv4(ip)){
          const name = v4toArpa(ip);
          const r = await fetchJson('https://dns.google/resolve?name='+name+'&type=PTR');
          const ans = (r.Answer||[]).find(x=>x.type===12);
          return ans ? ans.data.replace(/\.$/, '') : '—';
        }else if(isIPv6(ip)){
          const name = v6toArpa(ip);
          if(!name) return '—';
          const r = await fetchJson('https://dns.google/resolve?name='+name+'&type=PTR');
          const ans = (r.Answer||[]).find(x=>x.type===12);
          return ans ? ans.data.replace(/\.$/, '') : '—';
        }
        return '—';
      }catch{ return '—'; }
    }

    async function myPublicIP(){
      // try ipv6-aware api64, затем ipv4 api
      try{
        const j = await fetchJson('https://api64.ipify.org?format=json');
        return j.ip;
      }catch{}
      const j2 = await fetchJson('https://api.ipify.org?format=json');
      return j2.ip;
    }

    async function geoByIP(ip){
      // основа: ipwho.is (без ключа), фоллбек: ipapi.co
      try{
        const a = await fetchJson('https://ipwho.is/'+encodeURIComponent(ip));
        if(a && a.success !== false) return {src:'ipwho.is', data:a};
        throw new Error('ipwho.is fail');
      }catch{
        const b = await fetchJson('https://ipapi.co/'+encodeURIComponent(ip)+'/json/');
        if(b && !b.error) return {src:'ipapi.co', data:b};
        throw new Error('ipapi.co fail');
      }
    }

    function fillUI(ip, payload, src){
      // нормализуем
      let country = '—', cc=''; let city='—', region='—', postal='';
      let lat=null, lon=null; let tz='—', cur='—', cont='—';
      let asn='—', org='—', isp='—';
      if(src==='ipwho.is'){
        const d = payload;
        country = d.country || '—'; cc = d.country_code || '';
        city = d.city || '—'; region = d.region || '—'; postal = d.postal || '';
        lat = d.latitude; lon = d.longitude;
        tz = (d.timezone && (d.timezone.id || d.timezone)) || '—';
        cur = (d.currency && d.currency.code) ? d.currency.code : (d.currency || '—');
        cont = d.continent || '—';
        if(d.connection){
          asn = d.connection.asn ? 'AS'+d.connection.asn : '—';
          org = d.connection.org || d.connection.isp || '—';
          isp = d.connection.isp || d.connection.org || '—';
        }
      }else{
        // ipapi.co
        const d = payload;
        country = d.country_name || '—'; cc = d.country || '';
        city = d.city || '—'; region = d.region || '—'; postal = d.postal || '';
        lat = d.latitude ?? d.lat; lon = d.longitude ?? d.lon;
        tz = d.timezone || '—';
        cur = d.currency || '—';
        cont = d.continent_code || d.continent_name || '—';
        asn = d.asn || '—'; org = d.org || d.org_name || '—'; isp = d.org || '—';
      }

      ipOut.textContent = ip;
      const flag = cc ? ' <span class="flag">'+flagEmoji(cc)+'</span>' : '';
      countryOut.innerHTML = country + flag;
      cityOut.textContent = city;
      ispOut.textContent = (asn!=='—' ? asn+' · ' : '') + (org!=='—'? org : isp);
      coordOut.innerHTML = (lat!=null && lon!=null) ? `${lat}, ${lon}` : '—';
      tzOut.textContent = tz;
      currencyOut.textContent = cur;
      contOut.textContent = cont;
      regionOut.textContent = [region, postal].filter(Boolean).join(', ');

      const maps = (lat!=null && lon!=null) ? `<a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank" rel="noopener">Открыть в картах</a>` : '—';
      linksOut.innerHTML = maps + (ip ? ` · <a href="https://bgp.he.net/ip/${ip}" target="_blank" rel="noopener">BGP</a>` : '');

      jsonOut.textContent = fmt(payload);
    }

    async function runLookup(input){
      try{
        setStatus('Ищу…');
        let target = (input||'').trim();
        if(!target) throw new Error('Пустой запрос');

        // домен -> IP
        if(looksLikeDomain(target) && !isIPv4(target) && !isIPv6(target)){
          setStatus('Разрешаю домен…');
          target = await resolveHost(target);
        }

        setStatus('Геоданные…');
        const {src, data} = await geoByIP(target);
        fillUI(target, data, src);

        setStatus('Reverse DNS…');
        const ptr = await reversePtr(target);
        ptrOut.textContent = ptr;

        setStatus('Готово');
      }catch(e){
        setStatus('Ошибка: '+(e.message||e));
      }
    }

    myIp.addEventListener('click', async ()=>{
      setStatus('Определяю IP…');
      try{
        const ip = await myPublicIP();
        q.value = ip;
        await runLookup(ip);
      }catch(e){ setStatus('Ошибка определения IP'); }
    });

    lookup.addEventListener('click', ()=> runLookup(q.value));
    q.addEventListener('keypress', (e)=>{ if(e.key==='Enter') runLookup(q.value); });
    clearBtn.addEventListener('click', ()=>{
      q.value=''; ipOut.textContent='—'; countryOut.textContent='—'; cityOut.textContent='—';
      ispOut.textContent='—'; coordOut.textContent='—'; tzOut.textContent='—'; currencyOut.textContent='—';
      contOut.textContent='—'; regionOut.textContent='—'; ptrOut.textContent='—'; linksOut.textContent='—'; jsonOut.textContent='{}';
      setStatus('Очищено');
    });
    copyJson.addEventListener('click', ()=> navigator.clipboard.writeText(jsonOut.textContent||'{}').then(()=>setStatus('JSON скопирован')));

    // URL params: ?ip=8.8.8.8 или ?host=example.com
    const p = new URLSearchParams(location.search);
    if(p.has('ip')){ q.value = p.get('ip'); runLookup(q.value); }
    else if(p.has('host')){ q.value = p.get('host'); runLookup(q.value); }
  });
  </script>
</body>
</html>
